<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="login2.css">
    <title>Document</title>
</head>
<body>
    <div class="cont">
        <form action="" id="loginForm">
        <div class="form sign-in">
            <h2>Hos geldiniz!</h2>
            <label>
                <span>Email</span>
                <input type="email" id="username" required/>
            </label>
            <label>
                <span>Parol</span>
                <input type="password" id="password" required/>
            </label>
            <p class="forgot-pass">Paol bilenzokmy?</p>
            <button type="submit" class="submit">Girin</button>
         
        </div>
        </form>
        <div class="sub-cont">
            <div class="img">
                <div class="img__text m--up">
                 
                    <h3>Hasabynyz yokmy? Hasaba durmagynyzy hayyst edyaris!<h3>
                </div>
                <div class="img__text m--in">
                
                    <h3>Hasabynyz bar bolsa girin.<h3>
                </div>
                <div class="img__btn">
                    <span class="m--up">Hasaba durun</span>
                    <span class="m--in">Girin</span>
                </div>
            </div>
            <div class="form sign-up">
                <h2>Hasabynyzy doredin!</h2>
                 <form action="" id="registerForm">
                 <label>
                    <span>Ady</span>
                    <input type="text" name="name"/>
                </label>
                <label>
                    <span>Familiya</span>
                    <input type="text" name="Surname"/>
                </label>
                <label>
                    <span>Email</span>
                    <input type="email" name="email"/>
                </label>
                <label>
                    <span>Telefon nomer</span>
                    <input type="tel" name="tel" />
                </label>
                <label>
                    <span>Parol</span>
                    <input type="password" name="password"/>
                </label>
                <label>
               <select class="sel" id="region">
                <option value="">Welayaty saylan</option>
                </select>
                </label>

                 <label>
               <select class="sel" id="city">
                <option value="">Saheri sayla</option>
                </select>
                </label>
                <button type="submit" class="submit">Hasaba durun</button>
                </form>
            </div>
        </div>
    </div>
     <div id="result"></div>

    <script>
        document.querySelector('.img__btn').addEventListener('click', function() {
            document.querySelector('.cont').classList.toggle('s--signup');
        });
        const citySelect = document.getElementById("region");
        const districtSelect = document.getElementById("city");
        const resultEl = document.getElementById("result");

        let cities = [];
        let districts = [];
        async function loadCities() {
            try{
                const res = await fetch("https://rest.webigem.com.tr/api/v1/Cities");
                if(!res.ok) throw new Error("Cities load error");

                const json = await res.json();
                cities = json.data.categoryList;

                cities.forEach(c => {
                    const opt = document.createElement("option");
                    opt.value = c.cityId;
                    opt.textContent = c.city;
                    citySelect.appendChild(opt);
                });
            }catch (er) {
                console.error(er);
            }
        }
        
        citySelect.addEventListener("change", async function () {
            const cityId = this.value;
            districtSelect.innerHTML = "";
            districtSelect.disabled = true;
            resultEl.textContent = "";

            if(!cityId) return;
            try{
                const res = await fetch(`https://rest.webigem.com.tr/api/v1/Districts?cityId=${cityId}`);
                if(!res.ok) throw new Error("district load error");
                const json = await res.json();
                districts = json.data || [];
                
                districtSelect.innerHTML = `<option value="">Saheri sayla</option>`
                districts.forEach(d => {
                    const opt = document.createElement("option");
                    opt.value = d.districtId;
                    opt.textContent = d.district;
                    districtSelect.appendChild(opt);
                });
                city.disabled = false;

            }catch (er) {console.error(er)};
        });

        districtSelect.addEventListener("change", async function(){
            const districtId = this.value;
            if(!districtId) return;

            const city = cities.find(c => c.cityId==citySelect.value);
            const district = districts.find(d => d.districtId==districtId);

            const output = {welayatId: city.cityId,
                            welayat: city.city,
                            etrapId: district.districtId,
                            etrap: district.district
            };
            resultEl.textContent = JSON.stringify(output,null,2);
        });
        loadCities();

        //Login 
        const API_URL = "https://rest.webigem.com.tr/api/v2/CustomerLogin";
        const form = document.getElementById("loginForm");
        form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value;

    if (!username || !password) {
      resultEl.textContent = "Ýalňyş: E-poçta we açarsöz hökmany.";
      return;
    }

    const payload = {
      username,
      password,
    };

    resultEl.textContent = "Isleg iberilýär...";

    try {
      const resp = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Accept": "*/*",
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      const text = await resp.text();
      let data;
      try { data = JSON.parse(text); } catch { data = text; }

      resultEl.textContent =
        "HTTP: " + resp.status + "\n\n" +
        (typeof data === "string" ? data : JSON.stringify(data, null, 2));

    } catch (err) {
      resultEl.textContent =
        "Baglanyşyk ýalňşy: " + (err?.message || err) + "\n\n" +
        "Eger bu CORS bolsa: faýly lokal server bilen işlediň (Live Server ýaly).";
    }
  });

  //Registrasiya
   document.getElementById("registerForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const formData = new FormData(this);

  try {
    const response = await fetch(
      "https://rest.webigem.com.tr/api/v2/CreateAccountCustomer",
      {
        method: "POST",
        body: formData
      }
    );

    const data = await response.json();
    document.getElementById("result").textContent =
      JSON.stringify(data, null, 2);

  } catch (err) {
    document.getElementById("result").textContent =
      "Server bilen baglanysyk yok";
  }
});
    </script>
</body>
</html>